# Path to your oh-my-zsh configuration.
ZSH=$HOME/.oh-my-zsh

# PATHs
PATH=${PATH}:~/bin

# Set name of the theme to load.
# Look in ~/.oh-my-zsh/themes/
# Optionally, if you set this to "random", it'll load a random theme each
# time that oh-my-zsh is loaded.
ZSH_THEME="powerlevel9k/powerlevel9k"

# ZSH configuration
COMPLETION_WAITING_DOTS="true"
ZSH_HIGHLIGHT_HIGHLIGHTERS=(main brackets pattern cursor root)

# Start nvm
. ~/.nvm/nvm.sh

export NVM_DIR="/Users/lucasvogel/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"  # This loads nvm

autoload -U add-zsh-hook
load-nvmrc() {
	local node_version="$(nvm version)"
	local nvmrc_path="$(nvm_find_nvmrc)"

	if [ -n "$nvmrc_path" ]; then
		local nvmrc_node_version=$(nvm version "$(cat "${nvmrc_path}")")

		if [ "$nvmrc_node_version" = "N/A" ]; then
			nvm install
		elif [ "$nvmrc_node_version" != "$node_version" ]; then
			nvm use
		fi
	elif [ "$node_version" != "$(nvm version default)" ]; then
		echo "Reverting to nvm default version"
		nvm use default
	fi
}
add-zsh-hook chpwd load-nvmrc
load-nvmrc

# CUSTOM
export DEFAULT_USER="lucasvogel"

# POWERLEVEL9K

	# Custom functions
	prompt_customfields () {
		nodeversion=`node --version`;

		if [ -d .git ]; then
			branchName="· `git rev-parse --abbrev-ref HEAD | xargs`";
			uncommitedAddedAmount=`git diff --cached --numstat | wc -l | xargs`;
			uncommitedNotAddedAmount=`git status --porcelain 2>/dev/null| grep "^ M" | wc -l | xargs`;
			untrackedAmount=`git status --porcelain 2>/dev/null| grep "^??" | wc -l | xargs`;

			if [ $uncommitedAddedAmount = "0" ]; then
				uncommitedAdded="";
			else
				uncommitedAdded=" +$uncommitedAddedAmount";
			fi

			if [ $uncommitedNotAddedAmount = "0" ]; then
				uncommitedNotAdded="";
			else
				uncommitedNotAdded=" -$uncommitedNotAddedAmount";
			fi

			if [ $untrackedAmount = "0" ]; then
				untracked="";
			else
				untracked=" ?$untrackedAmount";
			fi

			branch="$branchName$uncommitedAdded$uncommitedNotAdded$untracked";
		fi

		if [ $? -eq 0 ]; then

		else
			statusField="· ×";
		fi

		echo -n "$nodeversion $branch $statusField";
	}

	# Elements
	POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(dir)
	POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(customfields)

	# Icon
	POWERLEVEL9K_HIDE_BRANCH_ICON=true
	POWERLEVEL9K_HIDE_NVM_ICON=true

	# Misc
	POWERLEVEL9K_SHORTEN_DIR_LENGTH=4
	POWERLEVEL9K_SHORTEN_STRATEGY=truncate_with_package_name
	ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=fg=4
	POWERLEVEL9K_TIME_FORMAT="%D{%H:%M \uE868  %d.%m}"


# OH-MY-ZSH init
source $ZSH/oh-my-zsh.sh

